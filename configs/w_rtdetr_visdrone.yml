# W-RT-DETR VisDrone Configuration
__include__: [
  'visdrone_detection.yml',
  'runtime.yml',
]

output_dir: ./output/w_rtdetr_visdrone_final

model:
  type: WRTDETR
  backbone_depth: 18
  num_classes: 10
  hidden_dim: 256
  num_queries: 300

criterion:
  type: SetCriterion
  weight_dict: {loss_vfl: 1, loss_bbox: 5, loss_nwd: 2}
  losses: ['vfl', 'boxes', 'nwd']
  matcher:
    type: FrequencySinkhornMatcher
    cost_class: 2.0
    cost_bbox: 5.0
    cost_nwd: 5.0
    iter_steps: 20

postprocessor:
  type: RTDETRPostProcessor
  num_classes: 10
  use_focal_loss: True
  num_top_queries: 300

optimizer:
  type: AdamW
  params:
    -
      params: '^(?=.*backbone)(?!.*norm).*$'
      lr: 0.00001
    -
      params: '^(?=.*encoder|decoder|query_selector)(?!.*norm).*$'
      lr: 0.0001
  weight_decay: 0.0001

lr_scheduler:
  type: CosineAnnealingLR
  T_max: 72
  eta_min: 0.0

train_dataloader:
  dataset:
    transforms:
      ops:
        - {type: RandomPhotometricDistort, p: 0.5}
        - {type: RandomZoomOut, fill: 0}
        - {type: RandomIoUCrop, p: 0.8}
        - {type: SanitizeBoundingBox, min_size: 1}
        - {type: RandomHorizontalFlip}
        - {type: Resize, size: [640, 640]}

        # [ğŸš¨ å…³é”®ä¿®å¤] å¿…é¡»åŠ ä¸Šè¿™ä¸€è¡Œï¼
        # 1. out_fmt='cxcywh': æŠŠ xyxy è½¬ä¸º ä¸­å¿ƒç‚¹+å®½é«˜ (DETRéœ€è¦)
        # 2. normalize=True: æŠŠ 0-640 è½¬ä¸º 0-1 (è§£å†³ Loss çˆ†ç‚¸)
        - {type: ConvertBox, out_fmt: 'cxcywh', normalize: True}

        - {type: ToImageTensor}
        - {type: ConvertDtype}

epoches: 72